<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Fact Atlas | Explore World Trivia</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3920233169460204" crossorigin="anonymous"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XNCT9N62VX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XNCT9N62VX');
    </script>

    <style>
        :root {
            --bg-color: #0f172a;
            --text-color: #f8fafc;
            --panel-bg: rgba(15, 23, 42, 0.95);
            --accent: #38bdf8;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        [data-theme="light"] {
            --bg-color: #f8fafc;
            --text-color: #0f172a;
            --panel-bg: rgba(255, 255, 255, 0.95);
            --accent: #0284c7;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Segoe UI', sans-serif; 
            color: var(--text-color); 
            background-color: var(--bg-color); 
        }
        
        /* --- MAIN GRID LAYOUT --- */
        #main-grid {
            display: grid;
            grid-template-columns: 60fr 40fr; /* 60% Content / 40% Map */
            height: 100vh;
            width: 100vw;
            overflow-y: auto; 
        }
        
        /* --- LEFT COLUMN: CONTENT AREA --- */
        #content-area-wrapper {
            padding: 40px;
            padding-top: 80px;
            padding-bottom: 145px; 
            max-width: 800px;
            margin: 0 auto;
            position: relative; 
            display: flex;
            flex-direction: column;
            min-height: 80vh; 
        }

        /* --- RIGHT COLUMN: MAP CONTAINER --- */
        #map-container {
            position: sticky;
            top: 0;
            height: 100vh; 
            background: #1e293b; 
            border-left: 1px solid rgba(255,255,255,0.1);
        }
        
        #map { 
            position: relative; 
            width: 100%; 
            height: 100%; 
        }

        /* --- NAVIGATION & CONTROLS --- */
        .navbar {
            position: absolute; 
            top: 30px; 
            right: 40px; 
            left: auto;
            z-index: 10;
            display: flex; 
            gap: 10px; 
            align-items: center;
            background: var(--panel-bg); 
            padding: 10px 15px; 
            border-radius: 12px;
            box-shadow: var(--shadow); 
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        #lang-select {
            background: transparent; 
            color: inherit; 
            border: none; 
            outline: none; 
            font-weight: 600; 
            cursor: pointer;
        }

        #lang-select option {
            background-color: #0f172a; 
            color: white; 
        }
        [data-theme="light"] #lang-select option {
            background-color: #f8fafc;
            color: #0f172a;
        }

        .nav-link { color: var(--text-color); text-decoration: none; font-size: 0.9rem; font-weight: 600; margin: 0 8px; }
        .nav-link:hover { color: var(--accent); }
        .theme-toggle { cursor: pointer; background: none; border: none; font-size: 1.2rem; margin-left: 10px; color: var(--text-color); }

        /* --- CONTENT STYLING --- */
        h1 { margin: 0 0 10px 0; font-size: 2.2rem; letter-spacing: -0.5px; }
        .subtitle { font-size: 1.2rem; opacity: 0.8; margin-bottom: 20px; display: block; line-height: 1.5; color: var(--accent);}

        .static-content h3 { font-size: 1.5rem; color: var(--text-color); margin-top: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .static-fact { 
            font-size: 1.1rem; 
            margin-bottom: 20px; 
            border-left: 4px solid var(--accent); 
            padding-left: 15px; 
            line-height: 1.7;
        }

        /* --- DYNAMIC FACT AREA --- */
        #dynamic-area { 
            background: var(--panel-bg); 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.1);
            display: none;
        } 
        p#fact-text { line-height: 1.7; font-size: 1.1rem; margin-bottom: 15px; min-height: 80px; }
        .location-name { font-weight: bold; color: var(--accent); text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1.5px; display: block; margin-bottom: 10px;}
        .source-link { color: var(--accent); font-size: 0.9rem; text-decoration: none; border-bottom: 1px dotted var(--accent); }

        /* Buttons & Footer */
        .btn-group { display: flex; gap: 10px; margin-top: auto; margin-bottom: 10px; }
        button.action-btn {
            flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: transform 0.1s;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #334155; color: white; }
        
        .footer-links { margin-top: 10px; text-align: center; font-size: 0.8rem; opacity: 0.7; }

        @media (max-width: 1000px) {
            #main-grid { grid-template-columns: 1fr; }
            #map-container { height: 50vh; position: relative; border-left: none; border-bottom: 1px solid rgba(255,255,255,0.1); }
            #content-area-wrapper { padding: 20px; padding-top: 80px; } 
            .navbar { left: 50%; transform: translateX(-50%); top: 10px; width: 90%; justify-content: center; right: auto;}
        }
    </style>
</head>
<body>

    <div id="main-grid">
        
        <div id="content-area-wrapper">

            <div class="navbar">
                <select id="lang-select" onchange="changeLanguage()">
                    <option value="English">ðŸ‡¬ðŸ‡§ EN</option>
                    <option value="Spanish">ðŸ‡ªðŸ‡¸ ES</option>
                    <option value="French">ðŸ‡«ðŸ‡· FR</option>
                    <option value="German">ðŸ‡©ðŸ‡ª DE</option>
                </select>
                <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ—</button>
            </div>
            
            <h1>Random Fact Atlas</h1>
            <span class="subtitle">An interactive 3D guide to world history, geography, and trivia. Spin the globe in the right panel to discover the secrets of our planet.</span>
            
            <div id="dynamic-area">
                <span class="location-name" id="location-name-dynamic">Location Fact</span>
                <p id="fact-text">Click anywhere on the globe or use the 'Surprise Me' button to load a unique, AI-generated fact about that location.</p>
                <a id="source-link" href="#" target="_blank" class="source-link" style="display:none;">ðŸ”Ž Verify this fact</a>
            </div>

            <div id="static-welcome">
                <div class="static-content">
                    <h3>Trivia Of The Week</h3>
                    <p>To ensure a diverse and educational experience, here are a few hand-picked facts generated by the Atlas:</p>
                    <div class="static-fact">
                        <strong>Coober Pedy, Australia:</strong> Due to scorching heat that frequently exceeds 40Â°C (104Â°F), about half of this townâ€™s population lives underground. Residents have carved "dugouts"â€”complete with full kitchens, televisions, and bedroomsâ€”directly into the rock.
                    </div>
                    <div class="static-fact">
                        <strong>KuÅŸkÃ¶y, Turkey:</strong> In this remote mountain village, residents communicate across deep valleys using a "bird language" (Turkish: kuÅŸ dili). It is not a code, but a way of whistling the syllables of Turkish words.
                    </div>
                    <div class="static-fact">
                        <strong>Hangzhou (Tianducheng District), China:</strong> This suburb is an eerily accurate replica of Paris, France. It features a 354-foot copy of the Eiffel Tower, a mock Champs-Ã‰lysÃ©es, and Haussmann-style architecture.
                    </div>
                    <div class="static-fact">
                        <strong>Alberobello, Italy:</strong> This town is famous for its trulliâ€”whitewashed stone huts with conical roofs. They weren't built for style; they were built to avoid taxes. In the 1600s, local rulers ordered residents to build homes without mortar so they could be quickly dismantled when royal tax inspectors were spotted, making the settlement look unfinished and untaxable.
                    </div>
                    <div class="static-fact">
                        <strong>Baarle-Nassau, Netherlands / Baarle-Hertog, Belgium:</strong> This town is a geographical mess of enclaves. The border is so complex it runs through restaurants, cafes, and private homes. You can sleep in one country and eat breakfast in another without leaving your house. In some spots, the border is marked by white crosses on the pavement, and laws (like restaurant closing times) apply based on which side of the line your table sits.
                    </div>
                </div>
                
                <p style="margin-top: 20px; font-size: 0.9rem; opacity: 0.9;">
                    The Random Fact Atlas is powered by Mapbox's 3D globe technology and Google's Gemini AI for content generation. We focus on providing unique, non-generic information on history, culture, and science.
                </p>
            </div>
            
            <div class="btn-group">
                <button class="action-btn btn-primary" onclick="flyToRandom()">Surprise Me</button>
                <button class="action-btn btn-secondary" onclick="refreshFact()">New Fact</button>
            </div>
            
            <p class="footer-links">
                <a href="about.html" class="nav-link" style="margin: 0;">About Us</a> | 
                <a href="privacy.html" class="nav-link" style="margin: 0;">Privacy Policy</a>
            </p>
            
        </div>

        <div id="map-container">
            <div id="map"></div>
        </div>
        
    </div>

    <div id="cookie-banner" style="display:none; position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(15, 23, 42, 0.95); color: white; padding: 15px; z-index: 9999; text-align: center; border-top: 1px solid #38bdf8;">
        <p style="margin: 0 0 10px 0; font-size: 0.9rem;">
            We use cookies to personalize content. <a href="privacy.html" style="color: #38bdf8;">Privacy Policy</a>.
        </p>
        <button id="accept-cookies" style="background: #38bdf8; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">I Accept</button>
    </div>

    <script>
        // PASTE YOUR TOKEN HERE
        mapboxgl.accessToken = 'pk.eyJ1IjoiZGlzY291bnRkZXYiLCJhIjoiY21pOHRnbWl6MDNtajJrcTA0M250ZjFpeiJ9.IQHxOtZGRv3VEz_Ifv1v4w'; 

        let currentTheme = 'dark';
        let currentLocation = null;
        let currentMarker = null;

        const majorCities = [
            {name: "New York, USA", lng: -74.0060, lat: 40.7128},
            {name: "Tokyo, Japan", lng: 139.6917, lat: 35.6895},
            {name: "London, UK", lng: -0.1276, lat: 51.5074},
            {name: "Paris, France", lng: 2.3522, lat: 48.8566},
            {name: "Cairo, Egypt", lng: 31.2357, lat: 30.0444}
        ];

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/satellite-streets-v12',
            projection: 'globe',
            zoom: 1.5,
            center: [-30, 20]
        });

        map.on('style.load', () => {
            map.setFog({ 'color': 'rgb(186, 210, 235)', 'high-color': 'rgb(36, 92, 223)', 'horizon-blend': 0.02, 'space-color': 'rgb(11, 11, 25)', 'star-intensity': 0.6 });
            map.resize(); 
        });

        function showDynamicContent() {
            document.getElementById('static-welcome').style.display = 'none';
            document.getElementById('dynamic-area').style.display = 'block';
        }

        function dropPin(lng, lat) {
            if (currentMarker) currentMarker.remove();
            currentMarker = new mapboxgl.Marker({ color: "#FF4444" })
                .setLngLat([lng, lat])
                .addTo(map);
        }

        map.on('click', async (e) => {
            showDynamicContent();
            const { lng, lat } = e.lngLat;
            dropPin(lng, lat);
            handleLocationSelect(lng, lat);
        });

        async function handleLocationSelect(lng, lat) {
            document.getElementById('fact-text').innerText = "Locating...";
            document.getElementById('location-name-dynamic').innerText = "Loading...";
            document.getElementById('source-link').style.display = 'none';
            
            map.flyTo({ center: [lng, lat], zoom: 4, essential: true });

            try {
                const response = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?types=place,locality&access_token=${mapboxgl.accessToken}`);
                const data = await response.json();

                if (data.features && data.features.length > 0) {
                    const placeName = data.features[0].text; 
                    const fullName = data.features[0].place_name;
                    currentLocation = { name: placeName, lat: lat, lng: lng };
                    
                    document.getElementById('location-name-dynamic').innerText = fullName;
                    fetchAiFact(placeName, lat, lng);
                } else {
                    document.getElementById('location-name-dynamic').innerText = "Unknown Location";
                    document.getElementById('fact-text').innerText = "You clicked on a very remote spot! Try clicking closer to a city.";
                    currentLocation = null;
                }
            } catch (error) { console.error(error); }
        }

        async function fetchAiFact(city, lat, lng) {
            const statusText = document.getElementById('fact-text');
            const selectedLang = document.getElementById('lang-select').value;
            statusText.innerText = "Consulting the Atlas...";
            
            try {
                const response = await fetch('/.netlify/functions/get-fact', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ city, lat, lng, language: selectedLang })
                });
                
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                const jsonStart = aiText.indexOf('{');
                const jsonEnd = aiText.lastIndexOf('}');
                
                if (jsonStart !== -1 && jsonEnd !== -1) {
                    const factData = JSON.parse(aiText.substring(jsonStart, jsonEnd + 1));
                    statusText.innerText = factData.text;
                    const sourceLink = document.getElementById('source-link');
                    if (factData.source_term) {
                        sourceLink.href = `https://www.google.com/search?q=${encodeURIComponent(factData.source_term)}`;
                        sourceLink.style.display = 'inline-block';
                    }
                } else {
                    statusText.innerText = "The AI returned an invalid response. Try again.";
                }
            } catch (error) {
                statusText.innerText = "The AI is thinking too hard. Try another spot.";
            }
        }

        function refreshFact() {
            if (currentLocation) {
                fetchAiFact(currentLocation.name, currentLocation.lat, currentLocation.lng);
            } else {
                flyToRandom();
            }
        }

        function changeLanguage() {
            if (currentLocation) refreshFact();
        }

        function flyToRandom() {
            showDynamicContent();
            const randomCity = majorCities[Math.floor(Math.random() * majorCities.length)];
            dropPin(randomCity.lng, randomCity.lat);
            handleLocationSelect(randomCity.lng, randomCity.lat);
        }

        function toggleTheme() {
            const root = document.documentElement;
            if (currentTheme === 'dark') {
                currentTheme = 'light';
                root.setAttribute('data-theme', 'light');
                map.setStyle('mapbox://styles/mapbox/streets-v12'); 
            } else {
                currentTheme = 'dark';
                root.setAttribute('data-theme', 'dark');
                map.setStyle('mapbox://styles/mapbox/satellite-streets-v12'); 
            }
        }

        if (!localStorage.getItem('cookiesAccepted')) {
            document.getElementById('cookie-banner').style.display = 'block';
        }
        document.getElementById('accept-cookies').addEventListener('click', function() {
            localStorage.setItem('cookiesAccepted', 'true');
            document.getElementById('cookie-banner').style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('location-name-dynamic').innerText = "Interactive Mode Ready";
            document.getElementById('fact-text').innerText = "Click on the globe to the right or hit 'Surprise Me' below to begin exploring world trivia.";
        });
    </script>
</body>
</html>


            

                

                